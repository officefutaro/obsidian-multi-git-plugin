# 機能要件定義書

**プロジェクト**: Obsidian Multi-Git Plugin  
**ドキュメント版**: 1.0.0  
**作成日**: 2024年10月22日

---

## 🎯 機能要件概要

### 要件の分類
| 分類 | 説明 | 優先度 |
|-----|------|--------|
| **MUST** | 必須機能（MVP） | 🔴 Critical |
| **SHOULD** | 重要機能 | 🟡 High |
| **COULD** | 有用機能 | 🟢 Medium |
| **WOULD** | 将来機能 | 🔵 Low |

---

## 🔴 MUST - 必須機能 (MVP)

### FR-001: リポジトリ検出機能
**優先度**: MUST  
**実装状況**: ✅ 完了

#### 要件
- Vault内のGitリポジトリを自動検出する
- 親ディレクトリのGitリポジトリを検出する
- ネストした複数階層のリポジトリに対応する

#### 受入基準
- [ ] Vault直下の.gitディレクトリを検出できる
- [ ] 親ディレクトリの.gitディレクトリを検出できる
- [ ] サブフォルダ内の.gitディレクトリを検出できる
- [ ] 検出されたリポジトリを一覧表示できる
- [ ] リポジトリの追加/削除を動的に反映する

#### テストケース
```gherkin
Scenario: Vault内リポジトリ検出
  Given Vaultディレクトリに.gitフォルダが存在する
  When プラグインを起動する
  Then リポジトリ一覧にVaultが表示される

Scenario: 親ディレクトリリポジトリ検出
  Given Vault親ディレクトリに.gitフォルダが存在する
  When プラグインを起動する
  Then リポジトリ一覧に親ディレクトリが表示される
```

---

### FR-002: Git ステータス表示機能
**優先度**: MUST  
**実装状況**: ✅ 完了

#### 要件
- 各リポジトリのGitステータスを表示する
- ファイル変更状態を分類表示する（M/A/D/?）
- ブランチ情報を表示する
- Ahead/Behind情報を表示する

#### 受入基準
- [ ] Modified ファイル一覧を表示できる
- [ ] Added ファイル一覧を表示できる
- [ ] Deleted ファイル一覧を表示できる
- [ ] Untracked ファイル一覧を表示できる
- [ ] 現在のブランチ名を表示できる
- [ ] リモートとのコミット差分を表示できる

#### UI要件
- ファイルタイプごとに色分け表示
- ファイル数のサマリー表示
- リポジトリごとの区分表示

---

### FR-003: Git コミット機能
**優先度**: MUST  
**実装状況**: ✅ 完了

#### 要件
- 手動でコミットメッセージを入力できる
- 複数リポジトリを選択してコミットできる
- コミット前に変更ファイルを確認できる

#### 受入基準
- [ ] コミットメッセージ入力フィールドがある
- [ ] リポジトリ選択チェックボックスがある
- [ ] 変更ファイル数を表示する
- [ ] コミット成功/失敗を通知する
- [ ] 空のコミットメッセージを拒否する

#### ビジネスルール
- コミットメッセージは必須入力
- 最低1つのリポジトリを選択必須
- 変更のないリポジトリは対象外

---

### FR-004: Git プッシュ/プル機能
**優先度**: MUST  
**実装状況**: ✅ 完了

#### 要件
- リモートリポジトリへのプッシュができる
- リモートリポジトリからのプルができる
- 複数リポジトリを選択して実行できる

#### 受入基準
- [ ] プッシュ操作を実行できる
- [ ] プル操作を実行できる
- [ ] 操作結果を通知する
- [ ] エラー時に適切なメッセージを表示する
- [ ] 認証エラーを適切に処理する

---

### FR-005: ステータスバー表示機能
**優先度**: MUST  
**実装状況**: ✅ 完了

#### 要件
- 全リポジトリの変更数を集計表示する
- 定期的に自動更新する
- クリックでステータス詳細を表示する

#### 受入基準
- [ ] `Git: X changes` 形式で表示する
- [ ] 30秒間隔で自動更新する
- [ ] クリックでGitStatusModalを開く
- [ ] 変更がない場合は `Git: 0 changes` と表示する

---

## 🟡 SHOULD - 重要機能

### FR-006: 設定管理機能
**優先度**: SHOULD  
**実装状況**: ❌ 未実装

#### 要件
- プラグイン設定画面を提供する
- デフォルトコミットメッセージを設定できる
- 自動更新間隔を設定できる
- 除外パターンを設定できる

#### 受入基準
- [ ] Obsidian設定タブに表示される
- [ ] 設定値の保存/読み込みができる
- [ ] デフォルト値が適切に設定される
- [ ] 設定変更が即座に反映される

#### 設定項目
```typescript
interface PluginSettings {
    autoRefresh: boolean;           // 自動更新有効/無効
    refreshInterval: number;        // 更新間隔（秒）
    defaultCommitMessage: string;   // デフォルトコミットメッセージ
    showParentRepo: boolean;        // 親リポジトリ表示
    excludePatterns: string[];      // 除外パターン
    confirmDestructive: boolean;    // 破壊的操作の確認
}
```

---

### FR-007: エラーハンドリング強化
**優先度**: SHOULD  
**実装状況**: 🔄 部分実装

#### 要件
- 日本語エラーメッセージを表示する
- Git認証エラーを適切に処理する
- ネットワークエラーを検出・報告する
- 復旧手順を提示する

#### 受入基準
- [ ] 全エラーメッセージが日本語化されている
- [ ] SSH認証失敗時の対処法を表示する
- [ ] ネットワーク断線時のリトライ機能
- [ ] リポジトリアクセス権限エラーの検出

#### エラーシナリオ
1. **Git未インストール**: Git実行ファイルが見つからない
2. **SSH認証失敗**: 公開鍵認証が失敗
3. **ネットワークエラー**: リモートリポジトリに接続できない
4. **権限エラー**: ディレクトリへの書き込み権限がない
5. **競合エラー**: マージ競合が発生

---

### FR-008: Git履歴表示機能
**優先度**: SHOULD  
**実装状況**: ❌ 未実装

#### 要件
- コミット履歴を一覧表示する
- 各コミットの詳細情報を表示する
- ファイル変更差分を表示する
- ブランチグラフを表示する

#### 受入基準
- [ ] 最新20件のコミット履歴を表示する
- [ ] コミットハッシュ、メッセージ、日時を表示する
- [ ] コミッターとオーサー情報を表示する
- [ ] ファイル変更一覧を表示する
- [ ] 行単位の差分を表示する

#### UI設計
```
Git History Modal
├── Repository Selector
├── Commit List
│   ├── Commit Hash (short)
│   ├── Commit Message
│   ├── Author & Date
│   └── Changed Files Count
└── Commit Detail Panel
    ├── Full Commit Info
    ├── Changed Files List
    └── File Diff Viewer
```

---

### FR-009: 日本語対応
**優先度**: SHOULD  
**実装状況**: ❌ 未実装

#### 要件
- UI要素をすべて日本語化する
- エラーメッセージを日本語化する
- 日本語コミットメッセージに対応する
- 日本語ファイル名に対応する

#### 受入基準
- [ ] ボタン・ラベルが日本語表示される
- [ ] エラーメッセージが日本語で表示される
- [ ] 日本語コミットメッセージが正常に処理される
- [ ] 日本語ファイル名が正常に表示される

#### 多言語対応方針
- 英語：デフォルト言語
- 日本語：完全対応
- その他：将来的に対応検討

---

## 🟢 COULD - 有用機能

### FR-010: ブランチ管理機能
**優先度**: COULD  
**実装状況**: ❌ 未実装

#### 要件
- ブランチ一覧を表示する
- 新しいブランチを作成する
- ブランチを切り替える
- ブランチをマージする

#### 受入基準
- [ ] 現在のブランチを強調表示する
- [ ] ローカル・リモートブランチを区別表示する
- [ ] ブランチ作成ダイアログを提供する
- [ ] ブランチ切り替え時の確認ダイアログ

---

### FR-011: 競合解決支援
**優先度**: COULD  
**実装状況**: ❌ 未実装

#### 要件
- マージ競合を検出する
- 競合ファイルを一覧表示する
- 競合解決の支援機能を提供する

#### 受入基準
- [ ] 競合状態を視覚的に表示する
- [ ] 競合ファイル一覧を表示する
- [ ] 外部マージツールとの連携

---

### FR-012: 統計・レポート機能
**優先度**: COULD  
**実装状況**: ❌ 未実装

#### 要件
- コミット統計を表示する
- ファイル変更頻度を分析する
- 開発活動グラフを表示する

#### 受入基準
- [ ] 日次/週次/月次コミット数グラフ
- [ ] ファイル変更頻度ヒートマップ
- [ ] 貢献者統計（複数開発者の場合）

---

## 🔵 WOULD - 将来機能

### FR-013: Git LFS対応
**優先度**: WOULD  
**実装状況**: ❌ 未実装

#### 要件
- Git LFSファイルを検出する
- LFSファイルの状態を表示する
- LFS固有操作を提供する

---

### FR-014: Git Hooks連携
**優先度**: WOULD  
**実装状況**: ❌ 未実装

#### 要件
- Pre-commit hooksを実行する
- Post-commit hooksを実行する
- Hook実行結果を表示する

---

### FR-015: 外部ツール連携
**優先度**: WOULD  
**実装状況**: ❌ 未実装

#### 要件
- GitKraken等のGitクライアント起動
- VSCode等のエディタでファイルを開く
- GitHub/GitLab等のWebページを開く

---

## 📊 要件トレーサビリティマトリックス

| 要件ID | 機能名 | 優先度 | 実装状況 | テスト状況 | 関連ファイル |
|--------|--------|--------|----------|------------|--------------|
| FR-001 | リポジトリ検出 | MUST | ✅ | ✅ | main.ts:71-101 |
| FR-002 | ステータス表示 | MUST | ✅ | ✅ | main.ts:103-147, 191-256 |
| FR-003 | コミット機能 | MUST | ✅ | ✅ | main.ts:258-342 |
| FR-004 | プッシュ/プル | MUST | ✅ | ✅ | main.ts:344-409 |
| FR-005 | ステータスバー | MUST | ✅ | ✅ | main.ts:149-158 |
| FR-006 | 設定管理 | SHOULD | ❌ | ❌ | 未作成 |
| FR-007 | エラーハンドリング | SHOULD | 🔄 | 🔄 | main.ts:180-188 |
| FR-008 | Git履歴 | SHOULD | ❌ | ❌ | 未作成 |
| FR-009 | 日本語対応 | SHOULD | ❌ | ❌ | 未作成 |
| FR-010+ | その他機能 | COULD/WOULD | ❌ | ❌ | 未作成 |

---

## 🔗 関連ドキュメント

### 設計文書
- [PLUGIN-SPECIFICATION.md](./PLUGIN-SPECIFICATION.md) - 全体仕様
- [TECHNICAL-ARCHITECTURE.md](./TECHNICAL-ARCHITECTURE.md) - 技術設計
- [API-SPECIFICATION.md](./API-SPECIFICATION.md) - API仕様

### 実装文書
- [IMPLEMENTATION-STATUS.md](./IMPLEMENTATION-STATUS.md) - 実装状況
- [CLAUDE-MAIN.md](./CLAUDE-MAIN.md) - 開発指示書

### テスト文書
- [TESTING-GUIDE.md](./TESTING-GUIDE.md) - テスト手順
- [test-strategy/](./test-strategy/) - テスト戦略

---

## 📝 変更履歴

| 版数 | 日付 | 変更内容 | 変更者 |
|-----|------|---------|--------|
| 1.0.0 | 2024-10-22 | 初版作成 | Claude |

---

**承認者**: futaro  
**最終レビュー**: 2024年10月22日